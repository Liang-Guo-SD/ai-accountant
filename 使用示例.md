# AI会计师系统使用示例

## 🎉 系统已成功修复并可以运行！

### 主要修复内容
1. ✅ 创建了缺失的 `main.py` 入口文件
2. ✅ 新增了 `app/utils/file_parser.py` 文件解析器
3. ✅ 修复了所有服务类的导入问题
4. ✅ 统一了配置管理到 `app/core/config.py`
5. ✅ 更新了 `requirements.txt` 添加缺失依赖
6. ✅ 修复了数据结构定义和验证问题

### 系统功能验证
- ✅ 配置验证通过
- ✅ AI信息提取正常工作（置信度0.98）
- ✅ RAG检索服务正常建立索引
- ✅ 文件解析器支持PDF和Excel格式
- ✅ 业务标准化服务正常工作

### 快速开始

#### 1. 环境准备
```bash
# 激活conda环境
conda activate accountant

# 进入项目目录
cd /Users/miaozhang/PycharmProjects/ai_accountant

# 安装依赖（如果需要）
pip install -r requirements.txt
```

#### 2. 配置环境变量
复制 `env.example` 为 `.env` 并填入您的API密钥：
```bash
cp env.example .env
# 编辑 .env 文件，填入您的 OPENAI_API_KEY 和 DASHSCOPE_API_KEY
```

#### 3. 初始化系统
```bash
python main.py init
```

#### 4. 查看系统状态
```bash
python main.py status
```

#### 5. 处理发票文件
```bash
# 处理单个文件
python main.py process data/invoice_sample.pdf --verbose

# 处理多个文件
python main.py process file1.pdf file2.pdf --date 2024-03-20

# 保存结果到文件
python main.py process data/invoice_sample.pdf --output results.json
```

#### 6. 运行系统测试
```bash
python main.py test
```

### 系统架构
```
📄 发票文档 → 🔧 文档解析 → 🤖 AI信息提取 → 📊 业务标准化 → 🔍 知识检索 → ⚙️ 分录生成 → 💾 数据存储
```

### 核心组件
- **文档处理器**: 统一的发票处理流水线
- **AI信息提取**: 使用GPT-4从发票中提取关键信息
- **业务标准化**: 将复杂业务描述标准化为会计术语
- **RAG检索**: 基于向量数据库的会计准则检索
- **凭证生成**: 智能生成符合会计准则的会计分录

### 支持的文件格式
- PDF文件（使用pdfplumber）
- Excel文件（.xlsx, .xls，使用pandas）

### 注意事项
1. 确保设置了正确的API密钥（OpenAI和DashScope）
2. 系统会自动创建必要的目录和数据库
3. 生成的会计分录仅供参考，重要业务请人工审核
4. 当前版本支持单借单贷分录

### 故障排除
如果遇到问题，可以：
1. 运行 `python main.py status` 检查系统状态
2. 运行 `python main.py test` 进行系统测试
3. 查看日志文件 `logs/app.log` 获取详细错误信息

### 下一步改进建议
1. 修复 `applied_rules` 字段的JSON解析问题
2. 添加更多文件格式支持
3. 优化AI提示词以提高准确性
4. 添加批量处理进度显示
5. 增加更多会计科目和业务规则

---
**恭喜！您的AI会计师系统已经可以正常运行了！** 🎉
